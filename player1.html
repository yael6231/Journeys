<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Player ‚Ä¢ Sha'ar HaBitachon</title>
  <style>
    :root{ --bg:#fdfaf6; --panel:#fffefb; --text:#333; --muted:#6d6354; --accent:#8b5cf6; --accent-2:#6366f1; --border:#ddd6c3; --brand:#4b3f2f; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 Georgia, serif}
    .wrap{max-width:900px;margin:32px auto;padding:20px}
    h1{margin:0 0 12px;color:var(--brand)}
    .player{display:grid;grid-template-columns:360px 1fr;gap:16px}
    @media (max-width:900px){.player{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .now{padding:16px;display:grid;gap:10px}
    .cover{width:100%;aspect-ratio:1/1;border-radius:10px;background:#faf7ef;border:1px dashed var(--border);display:grid;place-items:center;color:var(--muted)}
    .cover span{font-size:56px;font-weight:700}
    .meta h2{margin:0;font-size:20px;color:var(--brand)}
    .meta p{margin:0;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    .btn{border:1px solid var(--border);background:#faf7ef;color:var(--brand);border-radius:999px;padding:8px 12px;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));border-color:transparent;color:#fff;font-weight:700}
    input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:6px;border-radius:999px;border:1px solid var(--border);background:#faf7ef}
    input[type=range]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:14px; height:14px; border-radius:50%; background:var(--accent); border:none; }
    input[type=range]::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:var(--accent); border:none; }
    .time{font-size:12px;color:var(--muted);font-variant-numeric:tabular-nums}
    .playlist{padding:10px;max-height:70vh;overflow:auto}
    .track{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:10px;border-radius:10px;border:1px solid transparent;cursor:pointer}
    .track:hover{background:#faf7ef}
    .track.active{border-color:var(--accent);background:#f6f1e6}
    .no{width:28px;height:28px;display:grid;place-items:center;background:#faf7ef;border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:12px}
    .t-title{margin:0;color:var(--brand)}
    .t-artist{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üéß Sha'ar HaBitachon ‚Äî Test Player</h1>
    <div class="player">
      <section class="card now">
        <div class="cover" id="cover"><span>‚ô™</span></div>
        <div class="meta"><h2 id="title">‚Äî</h2><p id="artist">‚Äî</p></div>
        <div class="row">
          <button class="btn" id="prev">‚èÆ</button>
          <button class="btn primary" id="play">‚ñ∫ Play</button>
          <button class="btn" id="next">‚è≠</button>
          <div style="flex:1"></div>
          <button class="btn" id="loop">üîÅ</button>
          <button class="btn" id="mute">üîá</button>
        </div>
        <div class="row">
          <span class="time" id="current">0:00</span>
          <input id="seek" type="range" min="0" max="100" value="0" step="0.1" />
          <span class="time" id="duration">0:00</span>
        </div>
        <div class="row">
          <span class="time">Volume</span>
          <input id="volume" type="range" min="0" max="1" step="0.01" value="1" />
        </div>
      </section>
      <aside class="card playlist" id="playlist" aria-label="Playlist"></aside>
    </div>
  </div>

  <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>

  <script>
    const $ = s => document.querySelector(s);
    const fmt = s => (!isFinite(s)?'0:00':`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`);
    const initialsFrom = t => (String(t||'').match(/[A-Za-z◊ê-◊™]/g)||['‚ô™']).slice(0,2).join('').toUpperCase();

    const audio=$('#audio');
    const elTitle=$('#title'), elArtist=$('#artist'), elCover=$('#cover');
    const elPlay=$('#play'), elPrev=$('#prev'), elNext=$('#next');
    const elSeek=$('#seek'), elCurrent=$('#current'), elDuration=$('#duration');
    const elVolume=$('#volume'), elMute=$('#mute'), elLoop=$('#loop');
    const elPlaylist=$('#playlist');

    let tracks=[]; let i=0; let seeking=false;

    function renderPlaylist(){
      elPlaylist.innerHTML='';
      tracks.forEach((t,idx)=>{
        const d=document.createElement('div');
        d.className='track'+(idx===i?' active':'');
        d.innerHTML=`<div class="no">${idx+1}</div><div><p class="t-title">${t.title||'Untitled'}</p><div class="t-artist">${t.artist||''}</div></div><div class="time"></div>`;
        d.addEventListener('click',()=>{ if(!t.url){ alert('This track URL is empty.'); return; } if(idx!==i){i=idx; load(i,true);} else { audio.paused?audio.play():audio.pause(); } });
        elPlaylist.appendChild(d);
      });
    }
    function updateActive(){ [...elPlaylist.children].forEach((c,idx)=>c.classList.toggle('active', idx===i)); }
    function setCover(src,title){ if(src){ elCover.style.backgroundImage=`url(${src})`; elCover.innerHTML=''; } else { elCover.style.backgroundImage=''; elCover.innerHTML=`<span>${initialsFrom(title)}</span>`; } }
    function load(index,autoplay){ const t=tracks[index]; if(!t) return; elTitle.textContent=t.title||'Untitled'; elArtist.textContent=t.artist||''; setCover(t.cover,t.title); audio.src=t.url||''; updateActive(); if(autoplay) audio.play().catch(()=>{}); }

    elPlay.addEventListener('click',()=> audio.paused?audio.play():audio.pause());
    elPrev.addEventListener('click',()=>{ i=(i-1+tracks.length)%tracks.length; load(i,true); });
    elNext.addEventListener('click',()=>{ i=(i+1)%tracks.length; load(i,true); });
    elSeek.addEventListener('input',()=>{ seeking=true; const p=elSeek.value/100; audio.currentTime=p*(audio.duration||0); elCurrent.textContent=fmt(audio.currentTime); });
    elSeek.addEventListener('change',()=>{ seeking=false; });
    elVolume.addEventListener('input',()=>{ audio.volume=parseFloat(elVolume.value); audio.muted=audio.volume===0; });
    elMute.addEventListener('click',()=>{ audio.muted=!audio.muted; });
    elLoop.addEventListener('click',()=>{ audio.loop=!audio.loop; elLoop.classList.toggle('primary', audio.loop); });

    audio.addEventListener('play',()=>{ elPlay.textContent='‚ùö‚ùö Pause'; });
    audio.addEventListener('pause',()=>{ elPlay.textContent='‚ñ∫ Play'; });
    audio.addEventListener('timeupdate',()=>{ if(!seeking){ elCurrent.textContent=fmt(audio.currentTime); elDuration.textContent=fmt(audio.duration); const p=(audio.currentTime/(audio.duration||1))*100; elSeek.value=isFinite(p)?p:0; }});
    audio.addEventListener('ended',()=>{ if(!audio.loop) elNext.click(); });

    // Boot with one working MP3 + placeholders
    (function boot(){
      tracks = [
        { title: "Intro to Sha'ar HaBitachon ‚Äì Part 1", artist: "Rebbetzin Eisenbach", url: "https://yael6231.github.io/Journeys/audio/Chapter%201%2Bstart%20ch.2%20Sha%27ar%20HaBitachon%20%E2%80%93%20Part%201.mp3", cover: "" },
        { title: "Intro to Sha'ar HaBitachon ‚Äì Part 2", artist: "Rebbetzin Eisenbach", url: "", cover: "" },
        { title: "Intro to Sha'ar HaBitachon ‚Äì Part 3", artist: "Rebbetzin Eisenbach", url: "", cover: "" }
      ];
      renderPlaylist();
      load(0,false);
    })();
  </script>
</body>
</html>
