<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sha'ar HaBitachon ‚Ä¢ Audio Player</title>
  <style>
    :root{

      /* Light site theme */
      --bg:#fdfaf6; --panel:#fffefb; --text:#333; --muted:#6d6354;
      --accent:#8b5cf6; --accent-2:#6366f1; --border:#ddd6c3; --brand:#4b3f2f;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 Georgia, "Times New Roman", serif}
    .wrap{max-width:980px;margin:32px auto;padding:20px}
    h1{margin:0 0 10px;color:var(--brand)}
    .small{font-size:12px;color:var(--muted)}

    .player{display:grid;grid-template-columns:360px 1fr;gap:16px}
    @media (max-width:900px){.player{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .now{padding:16px;display:grid;grid-template-rows:auto auto 1fr auto;gap:12px}

    .cover{width:100%;aspect-ratio:1/1;border-radius:10px;background:#faf7ef;display:grid;place-items:center;border:1px dashed var(--border);color:var(--muted)}
    .cover span{font-weight:700;font-size:56px}

    .meta h2{margin:0;font-size:20px;color:var(--brand)}
    .meta p{margin:4px 0 0;color:var(--muted)}

    .controls{display:grid;gap:10px}
    .row{display:flex;align-items:center;gap:10px}
    .btn{appearance:none;border:1px solid var(--border);background:#faf7ef;color:var(--brand);padding:8px 12px;border-radius:999px;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));border-color:transparent;color:#fff;font-weight:700}
    input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:6px;border-radius:999px;border:1px solid var(--border);background:#faf7ef}
    input[type=range]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:14px; height:14px; border-radius:50%; background:var(--accent); border:none; }
    input[type=range]::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:var(--accent); border:none; }
    .time{font-variant-numeric:tabular-nums;font-size:12px;color:var(--muted)}

    .playlist{padding:8px;max-height:calc(100vh - 160px);overflow:auto}
    .track{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;padding:10px;border-radius:10px;border:1px solid transparent;cursor:pointer}
    .track:hover{background:#faf7ef}
    .track.active{border-color:var(--accent);background:#f6f1e6}
    .no{width:28px;height:28px;display:grid;place-items:center;background:#faf7ef;border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:12px}
    .t-title{font-size:15px;margin:0;color:var(--brand)}
    .t-artist{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üéß Sha'ar HaBitachon ‚Ä¢ Playlist</h1>
    <p class="small">Click a track to play. Space: play/pause ‚Ä¢ ‚Üê/‚Üí: seek ‚Ä¢ ‚Üë/‚Üì: volume. Only the first item is playable now; others will play once you upload MP3s to <code>/audio/</code>.</p>

    <div class="player">
      <!-- LEFT: Now Playing -->
      <section class="card now">
        <div class="cover" id="cover"><span>‚ô™</span></div>
        <div class="meta">
          <h2 id="title">‚Äî</h2>
          <p id="artist">‚Äî</p>
        </div>

        <div class="controls">
          <div class="row">
            <button class="btn" id="prev" title="Previous">‚èÆ</button>
            <button class="btn primary" id="play">‚ñ∫ Play</button>
            <button class="btn" id="next" title="Next">‚è≠</button>
            <div style="flex:1"></div>
            <button class="btn" id="loop" title="Loop">üîÅ</button>
            <button class="btn" id="mute" title="Mute">üîá</button>
          </div>

          <div class="row">
            <span class="time" id="current">0:00</span>
            <input id="seek" type="range" min="0" max="100" value="0" step="0.1" />
            <span class="time" id="duration">0:00</span>
          </div>

          <div class="row">
            <span class="time">Volume</span>
            <input id="volume" type="range" min="0" max="1" step="0.01" value="1" />
          </div>
        </div>

        <div class="small">Works with hardware keys on supported browsers.</div>
      </section>

      <!-- RIGHT: Playlist -->
      <aside class="card playlist" id="playlist" aria-label="Playlist"></aside>
    </div>
  </div>

  <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>

  <script>
    // ---------- Utilities ----------
    const $ = s => document.querySelector(s);
    const fmt = s => { if(!isFinite(s)) return '0:00'; const m=Math.floor(s/60), sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; };
    const initialsFrom = (title='') => (title.match(/[A-Za-z◊ê-◊™]/g)||['‚ô™']).slice(0,2).join('').toUpperCase();

    // ---------- Elements ----------
    const audio=$('#audio');
    const elTitle=$('#title'), elArtist=$('#artist'), elCover=$('#cover');
    const elPlay=$('#play'), elPrev=$('#prev'), elNext=$('#next');
    const elSeek=$('#seek'), elCurrent=$('#current'), elDuration=$('#duration');
    const elVolume=$('#volume'), elMute=$('#mute'), elLoop=$('#loop');
    const elPlaylist=$('#playlist');

    // ---------- State ----------
    let tracks=[]; let i=0; let seeking=false;

    // ---------- Rendering ----------
    function renderPlaylist(){
      elPlaylist.innerHTML='';
      tracks.forEach((t,idx)=>{
        const item=document.createElement('div');
        item.className='track'+(idx===i?' active':'');
        item.dataset.index=idx;
        item.innerHTML=`
          <div class="no">${idx+1}</div>
          <div>
            <p class="t-title">${t.title||'Untitled'}</p>
            <div class="t-artist">${t.artist||''}</div>
          </div>
          <div class="time"></div>`;
        item.addEventListener('click',()=>{ if(idx!==i){ i=idx; load(i,true); } else { audio.paused?audio.play():audio.pause(); } });
        elPlaylist.appendChild(item);
      });
    }
    function updateActive(){ [...elPlaylist.children].forEach((c,idx)=>c.classList.toggle('active', idx===i)); }
    function setCover(src,title){ if(src){ elCover.style.backgroundImage=`url(${src})`; elCover.style.backgroundSize='cover'; elCover.innerHTML=''; } else { elCover.style.backgroundImage=''; elCover.innerHTML=`<span>${initialsFrom(title)}</span>`; } }

    function load(index, autoplay=false){
      const t=tracks[index]; if(!t) return;
      elTitle.textContent=t.title||'Untitled';
      elArtist.textContent=t.artist||'';
      setCover(t.cover, t.title);
      audio.src=t.url||'';
      updateActive();
      if(autoplay) audio.play().catch(()=>{});
      updateMediaSession(t);
    }

    // ---------- Controls ----------
    elPlay.addEventListener('click',()=> audio.paused?audio.play():audio.pause());
    elPrev.addEventListener('click',()=>{ i=(i-1+tracks.length)%tracks.length; load(i,true); });
    elNext.addEventListener('click',()=>{ i=(i+1)%tracks.length; load(i,true); });

    elSeek.addEventListener('input',()=>{ seeking=true; const p=elSeek.value/100; audio.currentTime=p*(audio.duration||0); elCurrent.textContent=fmt(audio.currentTime); });
    elSeek.addEventListener('change',()=>{ seeking=false; });
    elVolume.addEventListener('input',()=>{ audio.volume=parseFloat(elVolume.value); audio.muted=audio.volume===0; });
    elMute.addEventListener('click',()=>{ audio.muted=!audio.muted; });
    elLoop.addEventListener('click',()=>{ audio.loop=!audio.loop; elLoop.classList.toggle('primary', audio.loop); });

    window.addEventListener('keydown',(e)=>{
      const tag=(e.target||{}).tagName; if(tag==='INPUT' || tag==='TEXTAREA' || e.metaKey || e.ctrlKey) return;
      if(e.code==='Space'){ e.preventDefault(); audio.paused?audio.play():audio.pause(); }
      else if(e.code==='ArrowRight'){ audio.currentTime=Math.min((audio.currentTime||0)+10,(audio.duration||0)); }
      else if(e.code==='ArrowLeft'){ audio.currentTime=Math.max((audio.currentTime||0)-10,0); }
      else if(e.code==='ArrowUp'){ audio.volume=Math.min(audio.volume+0.05,1); elVolume.value=audio.volume; }
      else if(e.code==='ArrowDown'){ audio.volume=Math.max(audio.volume-0.05,0); elVolume.value=audio.volume; }
    });

    audio.addEventListener('play',()=>{ elPlay.textContent='‚ùö‚ùö Pause'; });
    audio.addEventListener('pause',()=>{ elPlay.textContent='‚ñ∫ Play'; });
    audio.addEventListener('timeupdate',()=>{ if(!seeking){ elCurrent.textContent=fmt(audio.currentTime); elDuration.textContent=fmt(audio.duration); const p=(audio.currentTime/(audio.duration||1))*100; elSeek.value=isFinite(p)?p:0; }});
    audio.addEventListener('ended',()=>{ if(!audio.loop) elNext.click(); });
    audio.addEventListener('loadedmetadata',()=>{ elDuration.textContent=fmt(audio.duration); });
    audio.addEventListener('volumechange',()=>{ elMute.textContent=audio.muted?'üîä':'üîá'; });

    function updateMediaSession(t){
      if('mediaSession' in navigator){
        navigator.mediaSession.metadata=new MediaMetadata({ title:t.title||'', artist:t.artist||'', album:'Playlist', artwork:t.cover?[{src:t.cover,sizes:'512x512',type:'image/png'}]:[] });
        navigator.mediaSession.setActionHandler('previoustrack',()=>elPrev.click());
        navigator.mediaSession.setActionHandler('nexttrack',()=>elNext.click());
        navigator.mediaSession.setActionHandler('play',()=>audio.play());
        navigator.mediaSession.setActionHandler('pause',()=>audio.pause());
      }
    }

    // ---------- Boot: read inline JSON ----------
    (function boot(){
      const inline=document.getElementById('tracks-data');
      try{ tracks=JSON.parse(inline.textContent); }catch(e){ console.error('Playlist JSON parse error', e); tracks=[]; }
      renderPlaylist();
      if(tracks.length){ load(0,false); }
    })();
  </script>

  <!-- Inline playlist: first item points to your GitHub MP3 (works), others keep titles/links for now -->
  <script id="tracks-data" type="application/json">[
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 1","artist":"Rebbetzin Eisenbach","url":"https://yael6231.github.io/Journeys/audio/Chapter%201%2Bstart%20ch.2%20Sha%27ar%20HaBitachon%20%E2%80%93%20Part%201.mp3","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 2","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1TIUf6bteMy-5PPoIt8mDkeBoZdzFy4n5","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 3","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1axUuXa-9DR7SHvumT25DTbgZx33E_uYH","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 4","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1pEVEqT42PlI0VITAEsOB7VkbIiaJPeTt","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 5","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=17quXhf5l8cEj1mvgzUMvWvcQANvsG0dA","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 6","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1InRx3OmzK-biGANpsQXm6L3o3y29QelU","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 8","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=16ymiV9Zjc80GOrDXti8ubaj9cp7q1JrR","cover":""},
  {"title":"Intro to Sha'ar HaBitachon ‚Äì Part 9","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=13dyefmpXMrSJQTbSwfnHr1A09o1Ed0rB","cover":""},
  {"title":"Chapter 1 + Chapter 2 Sha'ar HaBitachon - Part 1 ‚Äì Part 1","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1bKeeG30E8A94AUl9bMNLgrJOKfaYofSk","cover":""},
  {"title":"Chapter 2: Sha'ar HaBitachon ‚Äì Part 2","artist":"Rebbetzin Eisenbach","url":"https://drive.google.com/uc?export=download&id=1mTtUI2LaxjoPpKGeOA3Y1iS6LdQxOnNT","cover":""}
]</script>
</body>
</html>
